---
import { slugifyStr } from "@/utils/slugify";
import { render, getEntry, type CollectionEntry } from "astro:content";
import { getPath } from "@/utils/getPath";
import Datetime from "./Datetime.astro";
import Tag from "./Tag.astro";
import { Image } from 'astro:assets';

const { data, id, filePath, collection } = Astro.props;

const entry = await getEntry(collection, id);

if (!entry) {
  throw new Error(`Could not find ${id}`);
}
const { Content } = await render(entry);

const body = entry.body; // raw markdown
const [excerpt] = body.split("<!-- more -->");
console.log(excerpt);
const { title, pubDatetime, modDatetime, timezone, tags, ogImage} =
  data;
const headerProps = {
  style: { viewTransitionName: slugifyStr(title) }
};

---

<article class="my-8 group" itemscope itemtype="https://schema.org/BlogPosting">
  <!-- Title Section -->
  <header class="mb-4">
    <a
      href={getPath(id, filePath)}
      itemprop="url"
      class="block transition-colors duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 hover:underline  underline-offset-5 "
    >
      <h3 {...headerProps} class="font-serif text-3xl font-medium leading-tight text-foreground" itemprop="headline">
        {title}
      </h3>
    </a>
  </header>

  <!-- Content Section -->
  <div class="mb-6">
    {ogImage && (
      <div class="float-left mr-6 mb-4">
        <Image 
          src={ogImage}  
          width="200" 
          height="200" 
          alt={`Featured image for ${title}`}  
          class="rounded-md border border-border/30 transition-transform duration-300 hover:scale-[1.02]"
        />
      </div>
    )}
    
    <div class="prose prose-sm max-w-none text-foreground/90 leading-relaxed" set:html={excerpt} />
    
    <div class="clear-both text-right">
      <a 
        href={getPath(id, filePath)}
        itemprop="url" 
        class="read-more-btn inline-flex items-center gap-2 text-accent font-medium text-sm py-1 px-2 rounded underline decoration-dotted underline-offset-5 hover:text-accent hover:decoration-solid transition-all duration-200"
      >
        czytaj dalej &raquo;
      </a>
    </div>
  </div>

  <!-- Footer Section -->
  <footer class="pt-4 border-t border-border/50 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 text-sm text-foreground/70">
    <Datetime {pubDatetime} {modDatetime} {timezone} />
    
    {tags && tags.length > 0 && (
      <div class="flex flex-wrap gap-2">
        {tags.map((tag: string) => <Tag tag={slugifyStr(tag)} tagName={tag} />)}
      </div>
    )}
  </footer>
</article>
